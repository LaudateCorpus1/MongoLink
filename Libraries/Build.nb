(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     15558,        335]
NotebookOptionsPosition[     14897,        307]
NotebookOutlinePosition[     15256,        323]
CellTagsIndexPosition[     15213,        320]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["MongoLink", "Title",
 CellChangeTimes->{{3.655742712076886*^9, 3.655742713787754*^9}, {
  3.662411188810762*^9, 3.662411190304761*^9}}],

Cell["This is a build script for MXNetLink.", "Text",
 CellChangeTimes->{{3.659860197165052*^9, 3.6598602101290007`*^9}, 
   3.6598602528829107`*^9, {3.659860302235612*^9, 3.6598603137771482`*^9}}],

Cell[BoxData["Quit"], "Input",
 CellChangeTimes->{{3.662111426700416*^9, 3.662111427106715*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FileNameJoin", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", "\"\<MXNetLink\>\""}], 
   "}"}], "]"}]], "Input"],

Cell[BoxData["\<\"/Users/sebastianb/git/mongodblink/Libraries/MXNetLink\"\>"],\
 "Output",
 CellChangeTimes->{3.662411187801837*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Switch", "[", 
    RowBox[{
    "$OperatingSystem", ",", "\n", "\t", "\"\<Windows\>\"", ",", " ", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"$CompileOptions", " ", "=", " ", "\"\<-std=c++11\>\""}], ";", 
      "\n", "\t\t", 
      RowBox[{"$MXNetLibraryName", " ", "=", " ", "\"\<mongoc.dll\>\""}], 
      ";"}], "\n", "\t", ",", "\n", "\t", "\"\<MacOSX\>\"", ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
      "$CompileOptions", " ", "=", " ", 
       "\"\<-std=c++11 -mmacosx-version-min=10.9 -stdlib=libc++\>\""}], ";", 
      " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Stupid", " ", "hack"}], " ", "*)"}], "\n", "\t\t", 
      RowBox[{"$MXNetLibraryName", " ", "=", " ", "\"\<libmxnet.so\>\""}], 
      ";"}], "\n", "\t", ",", "\n", "\t", "\"\<Unix\>\"", ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"$CompileOptions", " ", "=", " ", "\"\<-std=c++11\>\""}], ";", 
      "\n", "\t\t", 
      RowBox[{"$MXNetLibraryName", " ", "=", " ", "\"\<libmxnet.so\>\""}], 
      ";"}]}], "\n", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Needs", "[", "\"\<CCompilerDriver`\>\"", "]"}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"WL", " ", "Source"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"$CSourceDir", "  ", "=", " ", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
      "\"\<MongoLink\>\""}], "}"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$WLSource", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"$CSourceDir", ",", " ", "#"}], "}"}], "]"}], "&"}], " ", "/@",
     " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<mongolink.cpp\>\"", ",", " ", "\"\<common.cpp\>\"", ",", " ", 
      "\"\<connection.cpp\>\"", ",", " ", "\"\<bulk_insert.cpp\>\""}], 
     "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$WLInclude", " ", "=", " ", 
    RowBox[{"{", "$CSourceDir", "}"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"Mongo", " ", "Source"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"$MongoInc", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "\"\</usr/local/include/libmongoc-1.0\>\"", ",", " ", 
     "\"\</usr/local/include/libbson-1.0\>\""}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$MongoLib", " ", "=", " ", 
    RowBox[{"{", "\"\<mongoc-1.0.0\>\"", "}"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", "Build", " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"$Include", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{"$WLInclude", ",", " ", "$MongoInc"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$Libraries", " ", "=", " ", 
    RowBox[{"Join", "[", "$MongoLib", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"$MongoLinkLib", " ", "=", " ", 
   RowBox[{"CreateLibrary", "[", "\n", "\t", 
    RowBox[{"$WLSource", ",", " ", "\"\<MongoLink\>\"", ",", "\n", "\t", 
     RowBox[{"\"\<IncludeDirectories\>\"", "\[Rule]", " ", "$Include"}], ",", 
     "\n", "\t", 
     RowBox[{"\"\<Libraries\>\"", " ", "\[Rule]", " ", 
      RowBox[{"First", "@", "$MongoLib"}]}], ",", "\n", "\t", 
     RowBox[{"\"\<CompileOptions\>\"", "\[Rule]", "$CompileOptions"}], ",", 
     "\n", "\t", 
     RowBox[{"\"\<Language\>\"", " ", "->", " ", "\"\<C++\>\""}], ",", "\n", 
     "\n", 
     RowBox[{"(*", "\t", 
      RowBox[{
       RowBox[{
       "\"\<CompileOptions\>\"", " ", "\[Rule]", " ", "$CompileOptions"}], 
       ","}], "*)"}], "\n", "\t", "\n", "\t", 
     RowBox[{"\"\<Debug\>\"", " ", "\[Rule]", " ", "True"}]}], "\n", "]"}]}], 
  "\n"}], "\n"}], "Code",
 CellChangeTimes->{{3.655742720636463*^9, 3.655742730739047*^9}, {
   3.655742958622713*^9, 3.655743081153853*^9}, {3.655743169192954*^9, 
   3.655743223885983*^9}, {3.655743285799737*^9, 3.6557432899021387`*^9}, {
   3.65594466923932*^9, 3.655944670349471*^9}, {3.655945238183889*^9, 
   3.655945243989272*^9}, {3.655945454041267*^9, 3.655945483150941*^9}, {
   3.655945587598233*^9, 3.655945609123329*^9}, {3.6560059961870947`*^9, 
   3.6560059967594213`*^9}, {3.6560060796792316`*^9, 
   3.6560060962059107`*^9}, {3.65600629788076*^9, 3.6560063063186913`*^9}, 
   3.6560102316298437`*^9, {3.6560103253952103`*^9, 3.656010326121344*^9}, {
   3.656011141524913*^9, 3.656011182161365*^9}, {3.656012282090664*^9, 
   3.6560122937040863`*^9}, {3.6560123483466673`*^9, 3.656012350352351*^9}, {
   3.6560126678017178`*^9, 3.656012668297924*^9}, {3.656012743113818*^9, 
   3.6560127751591387`*^9}, {3.656015769485714*^9, 3.656015784547839*^9}, {
   3.656015899338749*^9, 3.656015972719791*^9}, 3.6560166564596567`*^9, 
   3.6563600373016987`*^9, {3.656360197033267*^9, 3.6563602152726793`*^9}, 
   3.6563603153186083`*^9, 3.656361332861775*^9, {3.6563613659235477`*^9, 
   3.6563613703323307`*^9}, 3.656361438610626*^9, {3.656361484737649*^9, 
   3.656361506624243*^9}, {3.656362461545795*^9, 3.6563624650724077`*^9}, {
   3.656362584807045*^9, 3.656362585318211*^9}, {3.656362738730534*^9, 
   3.656362740744808*^9}, {3.656370964328459*^9, 3.656370993960801*^9}, {
   3.6563716803386602`*^9, 3.656371717488031*^9}, 3.656371815153335*^9, {
   3.6563719207626534`*^9, 3.65637195615233*^9}, {3.6563720417181807`*^9, 
   3.656372060634964*^9}, {3.656372347765565*^9, 3.656372422835578*^9}, {
   3.6563724596371193`*^9, 3.656372489419087*^9}, {3.65637325576026*^9, 
   3.6563732560976887`*^9}, {3.6563734830040216`*^9, 3.6563736762673492`*^9}, 
   3.6563737181826477`*^9, {3.656373752684311*^9, 3.656373762004258*^9}, {
   3.656373908001437*^9, 3.656373970823504*^9}, {3.6563747633803988`*^9, 
   3.656374773203567*^9}, {3.656374900386045*^9, 3.6563749034338827`*^9}, {
   3.656456955191791*^9, 3.656457059436306*^9}, {3.659162788066918*^9, 
   3.6591628483266706`*^9}, {3.659162880797717*^9, 3.659162896666243*^9}, {
   3.659162934364293*^9, 3.659162963594069*^9}, {3.659163136902422*^9, 
   3.65916316210629*^9}, 3.6591632192786217`*^9, {3.659163258063957*^9, 
   3.659163343446041*^9}, {3.65916337913431*^9, 3.659163382581882*^9}, {
   3.659163760454125*^9, 3.6591638411831713`*^9}, 3.659164069567958*^9, {
   3.659164580085433*^9, 3.659164704506384*^9}, {3.659164863525955*^9, 
   3.659164866573197*^9}, {3.6591775311086082`*^9, 3.659177579817086*^9}, {
   3.65934434326851*^9, 3.659344365812209*^9}, {3.659344418908483*^9, 
   3.659344506372807*^9}, {3.6593551511787233`*^9, 3.659355215926652*^9}, {
   3.659357348828659*^9, 3.659357378236517*^9}, {3.659357643677538*^9, 
   3.659357841245912*^9}, {3.6593578786615753`*^9, 3.659357881652177*^9}, {
   3.659357967414044*^9, 3.659358037671612*^9}, {3.659358090134697*^9, 
   3.6593580998063498`*^9}, {3.6593581456750097`*^9, 3.659358146379045*^9}, {
   3.659358245948978*^9, 3.65935824665094*^9}, {3.659358389808589*^9, 
   3.6593583938062897`*^9}, 3.659358611592662*^9, {3.659358796458301*^9, 
   3.659358796667069*^9}, {3.6593588707476587`*^9, 3.659358985729827*^9}, {
   3.65935925178967*^9, 3.659359253297921*^9}, {3.659359459933879*^9, 
   3.6593594753473473`*^9}, {3.659359523014147*^9, 3.659359552443342*^9}, {
   3.659359623740879*^9, 3.6593596304895782`*^9}, {3.6593596664601316`*^9, 
   3.659359686530786*^9}, {3.659359770779222*^9, 3.659359771106035*^9}, {
   3.659359837554186*^9, 3.659359891417807*^9}, {3.6597812514052153`*^9, 
   3.6597812517699614`*^9}, {3.659864326114501*^9, 3.659864461639009*^9}, {
   3.6598645636350183`*^9, 3.659864644585127*^9}, {3.659864886508013*^9, 
   3.659864985651775*^9}, {3.659865063695952*^9, 3.6598650650701027`*^9}, 
   3.659865159910552*^9, {3.660457898029467*^9, 3.660457904378208*^9}, 
   3.6604579701800003`*^9, {3.660458040739389*^9, 3.660458056331296*^9}, {
   3.660458197971731*^9, 3.660458198658791*^9}, {3.660458712347678*^9, 
   3.660458712746455*^9}, {3.660468272075767*^9, 3.660468278988141*^9}, {
   3.660550054843562*^9, 3.660550057890733*^9}, {3.660827231283985*^9, 
   3.660827253753088*^9}, 3.660828305132915*^9, {3.660974392622306*^9, 
   3.660974397516472*^9}, {3.6616802593939657`*^9, 3.6616802994438257`*^9}, {
   3.662111255015242*^9, 3.662111275369677*^9}, {3.6621113805261383`*^9, 
   3.662111447348946*^9}, {3.662111480995672*^9, 3.662111514497345*^9}, {
   3.6624095301098757`*^9, 3.662409553307742*^9}, {3.662409669148973*^9, 
   3.662409785794541*^9}, {3.6624112238935328`*^9, 3.66241126852973*^9}, {
   3.662411299708015*^9, 3.6624114621499557`*^9}, 3.662411550501812*^9, {
   3.662411596220025*^9, 3.662411596413548*^9}, {3.662411637452777*^9, 
   3.6624116512698727`*^9}, {3.662411782322502*^9, 3.662411804186852*^9}, {
   3.6624125145162287`*^9, 3.6624125194644737`*^9}, 3.6624126036088943`*^9, {
   3.662412773663289*^9, 3.6624128181469593`*^9}, {3.6624128791327753`*^9, 
   3.662412899807107*^9}, {3.662413133078684*^9, 3.662413163138124*^9}, {
   3.662413194612769*^9, 3.662413200826276*^9}, {3.6624132358461723`*^9, 
   3.6624132448854923`*^9}, 3.66241327732386*^9, {3.662413419398489*^9, 
   3.662413455874579*^9}, {3.662413487732685*^9, 3.662413529842553*^9}, {
   3.6624135880045567`*^9, 3.662413588450941*^9}, {3.662413649476252*^9, 
   3.6624136983062973`*^9}, {3.662413783798149*^9, 3.662413785091031*^9}, {
   3.6624138207879868`*^9, 3.662413824027055*^9}, {3.662413900054104*^9, 
   3.6624139178827477`*^9}, {3.662454234083082*^9, 3.662454237913732*^9}, {
   3.662454323083025*^9, 3.662454328361833*^9}, {3.66246041182285*^9, 
   3.6624604270133553`*^9}}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{
  3.662413201124598*^9, {3.662413236248516*^9, 3.662413245148643*^9}, {
   3.662413421073419*^9, 3.662413456098127*^9}, {3.6624135167500963`*^9, 
   3.66241355323129*^9}, {3.662413642818879*^9, 3.662413698975212*^9}, {
   3.662413765866276*^9, 3.662413846039876*^9}, {3.662413894918432*^9, 
   3.6624139571649103`*^9}, 3.662414059022913*^9, {3.662453920760824*^9, 
   3.662453955693696*^9}, 3.6624540617521048`*^9, 3.662454115231215*^9, {
   3.662454239967634*^9, 3.6624542647829027`*^9}, 3.662454329553403*^9, 
   3.662454615428376*^9, 3.6624547637333612`*^9, 3.6624547976657887`*^9, 
   3.66245483860728*^9, 3.662454870626377*^9, 3.66245507694448*^9, 
   3.662455397624662*^9, 3.662455574641053*^9, {3.662455664538451*^9, 
   3.662455674998266*^9}, {3.662460395745426*^9, 3.662460418089826*^9}}],

Cell[BoxData["\<\"/Users/sebastianb/Library/Mathematica/SystemFiles/\
LibraryResources/MacOSX-x86-64/MongoLink.dylib\"\>"], "Output",
 CellChangeTimes->{
  3.662411805264544*^9, {3.662411849054419*^9, 3.662411874142655*^9}, 
   3.662411926286832*^9, 3.662411983760188*^9, 3.662412039436596*^9, 
   3.6624120872711573`*^9, 3.6624121935351543`*^9, {3.662412309190214*^9, 
   3.662412318957062*^9}, 3.662412372812505*^9, {3.662412421571044*^9, 
   3.66241244301507*^9}, 3.662412482820529*^9, {3.662412516039513*^9, 
   3.662412520807871*^9}, {3.662412604576951*^9, 3.662412622356141*^9}, {
   3.662412654436355*^9, 3.662412661165875*^9}, {3.662412775061633*^9, 
   3.6624128193305693`*^9}, {3.662412889551663*^9, 3.662412902236513*^9}, 
   3.6624131364143248`*^9, {3.662413196027244*^9, 3.662413201579927*^9}, {
   3.662413236727579*^9, 3.662413245599999*^9}, {3.6624134212728662`*^9, 
   3.662413456549062*^9}, {3.662413516808653*^9, 3.662413553277746*^9}, {
   3.6624136428849583`*^9, 3.662413699270342*^9}, {3.662413766167247*^9, 
   3.662413846222972*^9}, {3.662413895093719*^9, 3.662413957346477*^9}, 
   3.662414059030287*^9, {3.662453920836615*^9, 3.662453955701026*^9}, 
   3.662454062045217*^9, 3.6624541155381603`*^9, {3.662454240270646*^9, 
   3.6624542648767443`*^9}, 3.662454329562561*^9, 3.6624546154389544`*^9, 
   3.662454763830883*^9, 3.662454797675685*^9, 3.662454838614809*^9, 
   3.662454870634809*^9, 3.662455076953227*^9, 3.662455397632285*^9, 
   3.6624555746488047`*^9, {3.662455664729692*^9, 3.662455675008835*^9}, {
   3.662460395753305*^9, 3.662460418100771*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Copy", " ", "built", " ", "dynamic", " ", "lib", " ", "to", " ", "lib", 
    " ", "folder", " ", "in", " ", "package"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$MongoPackageLibDir", " ", "=", " ", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ParentDirectory", " ", "@", " ", 
         RowBox[{"NotebookDirectory", "[", "]"}]}], ",", " ", 
        "\"\<LibraryResources\>\"", ",", " ", "$SystemID"}], "}"}], "]"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"$MongoPackageLib", " ", "=", " ", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"$MongoPackageLibDir", ",", " ", 
        RowBox[{"FileNameTake", "@", "$MongoLinkLib"}]}], "}"}], "]"}]}], 
    ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"FileExistsQ", "@", "$MongoPackageLib"}], ",", " ", 
      RowBox[{"DeleteFile", "@", "$MongoPackageLib"}]}], "]"}], ";", " ", 
    RowBox[{"(*", " ", "Overwrite", " ", "*)"}], "\n", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"FileExistsQ", "@", "$MongoPackageLibDir"}]}], ",", " ", 
      RowBox[{"CreateDirectory", "@", "$MongoPackageLibDir"}]}], "]"}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{"CopyFile", "[", 
     RowBox[{"$MongoLinkLib", ",", " ", "$MongoPackageLib"}], "]"}], ";"}], 
   "\n", "\n", 
   RowBox[{"LibraryLoad", "@", "$MongoPackageLib"}], "\n", 
   "LibraryLink`$LibraryError"}]}]], "Code",
 CellChangeTimes->{3.662411425692749*^9}]
}, Open  ]]
},
WindowSize->{1234, 788},
WindowMargins->{{84, Automatic}, {-13, Automatic}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 11, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 141, 2, 92, "Title"],
Cell[724, 26, 197, 2, 30, "Text"],
Cell[924, 30, 96, 1, 28, "Input"],
Cell[CellGroupData[{
Cell[1045, 35, 178, 5, 28, "Input"],
Cell[1226, 42, 132, 2, 28, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1395, 49, 9448, 173, 700, "Code"],
Cell[10846, 224, 852, 12, 21, "Print"],
Cell[11701, 238, 1587, 22, 28, "Output"]
}, Open  ]],
Cell[13303, 263, 1578, 41, 194, "Code"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
